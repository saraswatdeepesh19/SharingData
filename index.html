@Configuration
public class R2dbcConfiguration extends AbstractR2dbcConfiguration {
    @Value("${spring.data.r2dbc.url}")
    private String url;

    @Value("${spring.data.r2dbc.username}")
    private String username;

    @Value("${spring.data.r2dbc.password}")
    private String password;

    @Override
    public R2dbcProperties r2dbcProperties() {
        return new R2dbcProperties().setUrl(url).setUsername(username).setPassword(password);
    }

    @Bean
    public R2dbcEntityTemplate r2dbcEntityTemplate() {
        return new R2dbcEntityTemplate(connectionFactory());
    }

    @Bean
    public ConnectionFactory connectionFactory() {
        return new PostgresqlConnectionFactory(PostgresqlConnectionConfiguration.builder()
                .host(r2dbcProperties().getHost())
                .port(r2dbcProperties().getPort())
                .username(r2dbcProperties().getUsername())
                .password(r2dbcProperties().getPassword())
                .database(r2dbcProperties().getDatabase())
                .build());
    }
}
